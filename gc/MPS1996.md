*注*：1 [原文链接](./MPS1996.pdf)

2 原文中“test”"tested"翻译为测试、测试的，主要出现在前期的参数选取过程中，通过多次测试计算选取合适参数；“experiment”“experimental”翻译为实验、实验的，指整个研究实验或者特指实际操作的实验，相对于模型模拟计算，用作判断模型模拟计算结果优劣的参照标准。



*名词解释*：

*拉格朗日方程（Lagrange equation）*：因数学物理学家[约瑟夫·拉格朗日](https://zh.wikipedia.org/wiki/约瑟夫·拉格朗日)而命名，是[分析力学](https://zh.wikipedia.org/wiki/分析力学)的重要方程，可以用来描述物体的运动，特别适用于理论物理的研究。拉格朗日方程的功能相等于[牛顿力学](https://zh.wikipedia.org/wiki/牛頓力學)中的[牛顿第二定律](https://zh.wikipedia.org/wiki/牛頓第二定律)。

*乔莱斯基分解（Cholesky decomposition）*：指将一个[正定](https://zh.wikipedia.org/wiki/正定矩陣)的[埃尔米特矩阵](https://zh.wikipedia.org/wiki/埃尔米特矩阵)分解成一个[下三角矩阵](https://zh.wikipedia.org/wiki/三角矩阵)与其[共轭转置](https://zh.wikipedia.org/wiki/共轭转置)之[乘积](https://zh.wikipedia.org/wiki/乘积)。这种分解方式在提高代数运算效率、[蒙特卡罗方法](https://zh.wikipedia.org/wiki/蒙特卡罗方法)等场合中十分有用。



### 运动粒子半隐式方法模拟不可压缩流体的碎裂现象

**摘要**：提出了一种用于模拟不可压缩流体碎裂的运动粒子半隐式（MPS）方法。通过与被核函数覆盖的相邻粒子的相互作用来计算每个粒子的运动。提出了确定性粒子相互作用模型，该模型表示了梯度，拉普拉斯算子和自由表面。由于不可压缩条件，流体密度被隐式的要求为常量，而其他项则是精确计算的。使用不完全乔莱斯基共轭梯度法求解压力的泊松方程。使用MPS计算水柱的崩塌。在测试计算中研究了模型参数的影响。即使发生流体的碎裂和聚结，也可以获得与实验的良好一致性。

#### 1 引言

​	计算机模拟已经被广泛地应用于分析日益复杂的几何和物理问题。然而，在核工程领域，我们仍然有许多难以通过计算机使用有限体积或有限元素方法进行分析的热工水力问题，其中包括界面的形状不断变化的水-汽两相流问题；应同时分析水、蒸汽和液态金属的蒸汽爆炸问题；以及应考虑流体和固体的巨大变形的流固耦合问题。

​	使用粒子的计算机模拟相较于使用网格的方法能够分析更复杂的几何和物理问题。尤其是，流体的拓扑变形可以通过粒子来分析，而不可能在这些域中连续地安装和移动网格。另一个优点是对流直接通过没有数值扩散的粒子运动来计算。因此，接口保持清晰。而且不需要生成网格。最近似乎使用网格方法分析越来越复杂的域，这需要生成越来越复杂的网格。虽然我们也需要在粒子方法中设置粒子的初始配置，但这比在生成网格中更容易，因为我们不需要在粒子之间建立拓扑关系。在计算过程中添加或删除粒子也更容易。

​	粒子方法大致可分为两类：（a）基于概率模型的方法，如分子动力学$^1$，直接模拟蒙特卡罗$^2$，和格子气体自动机$^3$，和（b）基于确定性模型的那些方法，如粒子力法$^4$，平滑粒子流体动力学（SPH）$ ^{5-10} $，无网格Euler / Navier-Stokes解算法$^{11}$，无单元Galerkin方法$^{12-14}$，和离散元方法$^{15}$。第一组方法表示将微观粒子的统计行为作为宏观属性，因此应该长时间跟踪大量粒子以获得准确的平均值。第二组方法需要更短的计算时间和更小的存储。SPH具有被用于天体物理学以确定星际气体的流体动力学，星际气体被认为是可压缩的无粘性流体。

​	网格-粒子混合方法，例如标记-和-网格$^{16}$，网格-内-粒子$^{17}$，和流体-隐式-粒子$^{18,19}$，部分地使用粒子来跟踪界面或计算对流项而没有数值扩散。在这些方法中，可以集成成功的网格方法技术，尽管它们仍然受到网格方法的限制。

​	一种用于模拟在许多工业应用中出现的不可压缩流体的确定性粒子方法被提出$^{20-22}$。Navier-Stokes方程中的所有项都用粒子相互作用模型表示。在试验计算中研究了这些模型的准确性；例如，在Poiseuille流量计算中得到了流速的抛物线分布。利用该方法计算了水柱的坍塌现象。但自由表面附近的粒子过于分散，与实验结果相比并不好。不可压缩模型的数值稳定性对该方法中使用的校正参数敏感，导致计算经常失败。计算时间比惯常的网格方法长许多。

​	在本文中，提出了一种改进的粒子方法，称为运动粒子半隐式（MPS）方法。由于MPS中改进的核函数和不可压缩模型，数值稳定性和计算速度得到显着提高。通过测试计算研究了MPS中使用的主要参数。使用根据所选参数修正后的方法再次计算了水柱的崩溃。

​	水柱的坍塌曾被用于验证自由表面的计算$^{23,24}$。 前缘的运动已经与实验进行了比较$^{25}$。在本实验中，自由表面保持平滑，因为没有障碍物或垂直的墙壁可以撞击坍塌的水。在Koshizuka，Oka和Tamako$^{21,22}$的实验中，添加了垂直壁以产生流体的碎裂和聚结。将用于与当前计算进行比较。在文献26中，使用网格方法计算具有墙壁和障碍物的圆柱形水柱的坍塌。计算结果与实验结果进行了比较。尽管计算了流体的碎裂，但是自由表面不清晰。这一定是因为数值扩散，这在基于固定网格进行的流体碎裂的对流计算中是不可避免的。

#### 2 控制方程

​	不可压缩流体的控制方程是连续性方程和Navier-Stokes方程，如下：
$$
\frac{\part\rho}{\part t}=0		\tag{1}
$$
和
$$
\frac{Du}{Dt}=-\frac{1}{\rho}\nabla P+f.		\tag{2}
$$
连续性方程使用密度给出，而速度散度通常用于网格方法。 Navier-Stokes方程[等式（2）]的左侧表示包括对流项的拉格朗日微分。通过跟踪粒子运动直接计算。右侧由压力分布和外力项组成。由微分算子表示的所有项都应该由粒子相互作用代替。

#### 3 粒子相互作用模型

##### 3.1 核

​	粒子与附近其他粒子的相互作用由核方程$ w( r )$表示，其中$r$是两个粒子之间的距离。这个概念已经用于SPH方法。在本研究中，采用以下方程（图1）：
$$
w(r)=\left\{\begin{array}{r} \frac{r_e}{r}-1, & (0\le r<r_e)\\
0, & (r_e\le r)\end{array}\right.		\tag{3}
$$
由于该核函数覆盖的区域是有界的，因此粒子与有限数量的相邻粒子相互作用。交互区域的半径由参数$r_e$确定。与覆盖无限区域的核函数（例如高斯函数）相比，当前函数需要更少的存储器和计算时间。

​	核函数在$r = 0$时是无穷大。这对于不可压缩模型中的数值稳定性是有利的。另一方面，文献20、21和22中使用的旧核函数在$r=0$时给出了有限值。两者之间的差别稍后用测试计算说明。

##### 3.2 粒子数量密度

​	其中粒子$i$所在的位置坐标$r_i$处的粒子数密度定义为：
$$
\langle n\rangle_i=\sum_{j\ne i}w(|r_j-r_i|).		\tag{4}
$$
在这个等式中，不考虑粒子$i$本身的贡献。当单位体积中的粒子数由$\lang N\rang_i$表示时，和$\lang n\rang_i$之间的关系写为
$$
\lang N\rang_i=\frac{\lang n\rang_i}{\int_vw(r)dv}.		\tag{5}
$$
等式（5）的分母是整个区域中核的积分，不包括粒子$i$占据的中心部分。假设粒子具有相同的质量$m$，我们可以看到流体密度与粒子数密度成正比：
$$
\lang\rho\rang_i=m\lang N\rang_i=\frac{m\lang n\rang_i}{\int_vw(r)dv}.		\tag{6}
$$
因此，如果粒子数密度是常数，就满足连续性方程。该常数值用$n^0$表示。

##### 3.3 梯度建模

​	两个粒子i和j之间的梯度向量，使用在坐标$r_i$和$r_j$处的标量$\phi_i$和$\phi_j$简单地定义$(\phi_j-\phi_i)(r_j-r_i)/|r_j-r_i|^2$。我们可以用任意的两个粒子组合来评估梯度向量。粒子$i$及其相邻粒子$j$之间的梯度向量用核函数加权并平均以获得粒子$i$处的梯度向量：
$$
\lang\nabla\phi\rang_i=\frac{d}{n^0}\sum_{j\ne i}\left[\frac{\phi_j-\phi_i}{|r_j-r_i|^2}(r_j-r_i)w(|r_j-r_i|)\right],		\tag{7}
$$
其中$d$是空间维度数。这个模型用作MPS的压力梯度项。

​	当粒子聚集时，压力增加并且排斥力在粒子之间起作用以满足连续性方程。根据等式（7），两个粒子之间距离变短时会产生更大的排斥力。这个良好特性避免粒子聚集在一起。

​	目前的模型对绝对压力不敏感。这与只对相对压力分布敏感的不可压缩流体的性质一致。

​	如果粒子$i$位于其所有相邻粒子$j$的中心，则有下面近似的等式：
$$
0=\sum_{j\ne i}\left[\frac{(r_j-r_i)}{|r_j-r_i|^2}w(|r_j-r_i|)\right].		\tag{8}
$$
因此，等式（7）可以重写为：
$$
\lang\nabla\phi\rang_i=\frac{d}{n^0}\sum_{j\ne i}\left[\frac{\phi_j-\phi_i'}{|r_j-r_i|^2}(r_j-r_i)w(|r_j-r_i|)\right],		\tag{9}
$$
其中$\phi_i'$可以是任何常量值。在代码中，等式（9）代替等式（7）作为模型梯度，并且$\phi_i'$根据下式计算：
$$
\phi_i'=min(\phi_j),		\tag{10}
$$
其中$j$满足
$$
w(|r_j-r_i|)\ne0.
$$

##### 3.4 拉普拉斯建模

​	使用拉普拉斯算子表示基于时间的$ \phi $扩散问题
$$
\frac{d\phi}{dt}=v\nabla^2\phi,		\tag{11}
$$
其中$v$是扩散系数。在时间步长$\Delta t$期间$\phi$的分布的变化量增长了$2dv\Delta t$，其中$d$是空间维度数。在当前模型中，粒子$i$的数值$ \phi_i $的一部分根据核函数分布到相邻粒子，使得增加的变化量等于$2dv\Delta t$。因此，从粒子$i$转移到$j$的量为
$$
\Delta\phi_{i\to j}=\frac{2dv\Delta t}{n^0\lambda}\phi_iw(|r_j-r_i),		\tag{12}
$$
其中
$$
\lambda=\frac{\int_vw(r)r^2dv}{\int_vw(r)dv}.		\tag{13}
$$
就线性扩散而言，数量转移可以叠加。最终，拉普拉斯算子模型表示为
$$
\lang\nabla^2\phi\rang_i=\frac{2d}{n^0\lambda}\sum_{j\ne i}(\phi_j-\phi_i)w(|r_j=r_i|).		\tag{14}
$$
当前的拉普拉斯算子模型是保守的，因为粒子$i$损失的量仅由粒子$j$获得。

##### 3.5 不可压缩建模

​	连续性方程要求流体密度应该是恒定的。这相当于粒子数密度为常数$n^0$。当粒子数密度$n^*$不等于$n^0$时，将其隐含地修正为$n^0$：
$$
n^*+n'=n^0,		\tag{15}
$$
其中$n'$为修正值。这与质量守恒方程中的速度修正值类似：
$$
\frac{1}{\Delta t}\frac{n'}{n^0}=-\nabla\cdot u'.		\tag{16}
$$
速度修正值是从下面的隐式压力梯度项导出
$$
u'=-\frac{\Delta t}{\rho}\nabla P^{n+1},		\tag{17}
$$
使用等式（15）（16）和（17），得到一个压力的泊松等式：
$$
\lang\nabla^2P^{n+1}\rang_i=-\frac{\rho}{\Delta t^2}\frac{\lang n^*\rang_i-n^0}{n^0}.		\tag{18}
$$
右侧使用粒子数密度偏离常数值的差值表示，而在网格方法中通常是速度扩散。方程（18）的左侧由拉普拉斯模型[等式（14）]离散化得到。最后，我们得到由线性对称矩阵表示的联立方程。这些通过非完全的Cholesky共轭梯度（ICCG）方法解决。压力梯度项由梯度模型[等式（9）]计算，其中标量$ \phi $由$P^{n+1}$代替。

​	由于构造了矩阵方程并使用ICCG求解，当前模型的计算速度比文献20,21和22中使用的模型快很多。此外，即使在粒子配置严重变形的情况下，ICCG的鲁棒性也使得计算更加稳定。

​	通过处理微分方程获得等式（18），使得等式（18）的离散化形式与原始等式[等式（15），（16）和（17）]的离散化形式不一致。换句话说，从修改后的粒子坐标估算出的修改后的粒子数密度不等于$ n^0 $。然而，这种不一致性并不严重，因为粒子数密度的误差不会在每个时间步骤中累加，并且因为通过保持粒子的数量来严格保证了质量守恒。

​	整个算法在图2中描述。在每个时间步长中，精确地计算源项并且获得临时速度$u^*$。接下来，计算粒子的运动，并获得临时坐标$r^*$。这对应于对流项。利用表示粒子数密度偏差的源项求解压力的泊松方程，然后获得新的临时压力值。最后，我们通过将压力梯度项与新的临时压力值相加来获得新临时速度和坐标。该算法基本上是半隐式时间推进，这种推进方式已广泛应用于网格方法中。

##### 3.6 自由表面建模

​	由于粒子的完全拉格朗日运动，自由表面总是清晰的。粒子数密度满足
$$
\lang n\rang_i^*<\beta n^0
$$
的粒子被视作自由表面，其中参数$\beta$小于$1.0$。当压力泊松方程求解时，给予该粒子零压力作为边界条件。参数$ \beta $的影响稍后描述。

#### 4 水柱坍塌

##### 4.1 几何

​	计算了水柱的坍塌，并且图3是实验装置的几何图示。在该几何装置中进行了实验$^{21,22}$。水柱最初位于左侧垂直墙上。在实验中，初始水柱由可移动板支撑，该板快速滑动以开始坍塌。坍塌的水撞击在右侧垂直壁上，这会产生流体的碎裂和聚结。没有这个右垂直墙的问题已被用作自由表面代码的验证$ ^{23,24} $。在这种情况下，自由表面的形状保持平滑，因此可以使用网格方法。

##### 4.2 计算参数

​	通过水柱坍塌的测试计算来研究当前粒子相互作用模型中使用的参数。

​	自由表面参数$ \beta$用于判断粒子是否在自由表面上[方程（19）]。图4显示了被视为自由表面的粒子数量。从$\beta=0.8\to0.99$轨迹几乎相同，尽管它们在参数较小时平行下降。$\beta=0.7$的计算结果从$0.0$s显示了不同的轨迹，在$0.6$s时异常终止。我们可以得出结论，如果计算稳定进行，自由表面参数对计算结果没有影响。参数可以从0.8到0.99中选择。在本研究中，选择0.97。

​	核尺寸由方程（3）中的参数$ r_e$表示。较大的核尺寸会导致更多的粒子进行交互。核函数用于计算粒子数密度，压力梯度项和压力拉普拉斯算子。没有必要为这三个计算使用共同的内核大小。在图5中显示了核尺寸的影响，其中$r_{en}$用于粒子数密度，压力梯度项和$r_{eLap}$用于压力的拉普拉斯算子。当$r_{en}=r_{eLap}\ge1.8l_0$时计算成功，其中$l_0$是初始配置中相邻粒子之间的距离。当$r_{en}=r_{eLap}=1.6l_0$时发生数值爆炸。如果$ r_e $太小，则相互作用的相邻粒子的数量太少而不能进行准确和稳定的计算。存在数值稳定性的最小极限值是合理的。当$r_{en}=r_{eLap}=1.8l_0$时，在$0.1\to0.15$秒之间自由表面上的粒子数量异常高。这意味着发生了数值不稳定但被控制住了。

​	我们可以看到在$r_{en}=r_{eLap}=3.0和4.0l_0$时从$0.0$到$0.1$秒的奇怪轨迹。初始数量大于其他情况，并减少直到$0.1$秒。粒子的初始配置像一个方形网格（见图10a-2）。外围粒子被认为是自由表面，因为较少的相邻粒子位于核函数所在的位置。当核尺寸小时，在这种情况下是指低于$3.0l_0$，来自水柱外围的第一行上的粒子被判断为自由表面。当核尺寸较大时，内部区域中的更多粒子满足自由表面条件。因此，初始数字很大（图5显示的是自由表面的粒子数）。图6显示了在$0.1$秒下计算的粒子配置，其中$r_{en}=r_{eLap}=4.0l_0$。我们可以看到聚集在自由表面附近的粒子。结果，内部粒子的粒子数密度增加，并且它们不再被判断为自由表面。这导致数量减少。因此，核大小应$<3.0l_0$，否则粒子将聚集在自由表面附近。另一方面表明，当核大小$r_{eLap}$更大时，拉普拉斯算子的离散化更准确$ ^{21,22}$。为了满足这些对立的要求，在本研究中对于$r_{en}$和$r_{eLap}$采用不同的值：$r_{en}=2.1l_0且r_{eLap}=4.0l_0$。

​	一次迭代所需的平均CPU时间如图7所示。使用硅谷图形公司（译者注：1981至2006）的$Indigo^2$进行计算。最耗时的进程是泊松压力方程的ICCG求解器。该进程包括矩阵的生成，不完整的乔莱斯基分解和迭代过程。当核尺寸增加时，用于分解的CPU时间变得相对较长，因为分解和迭代的CPU时间分别与$N_PN_B^2$和$N_P^{1.5}N_B^{0.5}$成正比，其中$N_P$是粒子的总数，$N_B$是相互作用的相邻粒子树。相邻粒子的数量与二维中核尺寸的平方成正比。一般认为，在涉及$10^6$个粒子的大模型中，相邻粒子的表的生成占据主导地位，因为该进程（耗时）与$ N_P^2$成比例。

​	文献20、21和22中使用的旧的核函数也进行了测试，函数为
$$
w(r)= \left\{\begin{array}{l}-(2r/r_e)^2+2 & (0\le r<\frac{1}{2}r_e) \\
(2r/r_e-2)^2 & (\frac{1}{2}r_e\le r<r_e) \\
0 & (r_e\le r) \end{array}\right.		\tag{20}
$$
与当前核函数[等式（3）]最重要的区别在于该值在$r=0 $处是有限的。自由表面上的粒子数量如图8所示。当前核函数的一个案例[等式 （3）]也包括在图中。当$1.4l_0\le r_{en}=r_{eLap}\le1.7l_0$时，计算成功。这个范围相当窄。当$r_{en}=r_{eLap}\ge1.8l_0$时，结果偏离正确的轨迹。例如，在图9中显示了$r_{en}=r_{eLap}=2.0l_0$在0.35秒处的粒子配置。我们可以看到粒子到处聚集。使用方程（20），两个粒子可以占据相同的位置，如果$2w(0)<\beta n_0$，则满足不可压缩条件。这些颗粒被认为是自由表面，它们之间没有排斥力。因此，粒子聚集。如果像等式（3）中那样设置$w(0)=\infty$，则可以避免这种麻烦。因此，使用当前的核函数计算是稳定的。表$I$总结了计算参数的选定值。

##### 4.3 计算结果及与实验的对比

​	使用表$I$中列出的所选参数进行水柱坍塌的计算。忽略粘度和表面张力。在图10中，对于实验（照片）和计算（计算机生成的图表）结果，从$0.0$到$1.0$秒以$0.1$秒的间隔显示流体的配置。

​	可移动板支撑实验中的初始水柱。该板在0.05秒内被拉起并开始坍塌。在计算中，水柱由位于方形网格中的648（$18\times32$）个粒子表示。两个相邻粒子10之间的距离$l_0$为$8.0\times10^{-3}$米。

​	左，右和底部墙壁由474个颗粒表示。它们的坐标是固定的，速度为零。墙壁内侧第一层上的粒子参与压力计算。作为不可压缩性模型的源项，这些粒子需要粒子数密度。因此，应该在外侧添加另外两层粒子，因为$r_{en}=2.1l_0$，否则粒子数密度小，墙壁粒子被识别为自由表面。在MPS中，通过布置固定粒子来表示墙壁边界。这比网格方法简单。

​	在图10中，流速矢量显示为粒子中心发出的线。速度比例为$10^{-2}$，这意味着速度$1.0$米每秒由线长$10^{-2}$米表示。在$0.1$秒（图10b），水柱的右表面受到实验中支撑板运动的干扰。在$0.2$秒，坍塌的水在底壁上奔流（图10c）。在0.3秒处，加速的水冲击在右侧垂直墙上并上升（图10d）。在0.4秒，我们可以看到水溅到了最初的水柱高度上方（图10e）。在实验中，上升的水形成一个附着在垂直壁上的薄膜，而在计算中它更加碎片化。粒子太大因而不能模拟这个薄膜。在0.5秒时失去其动量（图10f）并在0.6秒开始下降（图10g）。在0.7秒处可以看到蘑菇形状（图10h）。0.8秒，下降的水流撞击底部的水流并向左上方反射（图10i）。0.9秒，反射的水向左侧墙壁飞行（图10j）并在1.0秒处撞击左侧墙壁（图10k）。水的计算结果与实验结果一致，直到1.0秒。一致性比文献21和22中的要好得多。这归功于修改后的核函数和MPS中的不可压缩性建模。	

​	前缘的运动，即在底壁上运行的坍塌水柱的前部，如图11所示。文献23中的计算结果和文献25中的实验数据也包括在内。目前的计算结果与SOLA-VOF几乎相同。在实验中，前沿的速度比计算的速度慢。这是由于流体和底壁之间的摩擦。我们可以看到图10c-1中的前缘是圆形的。

#### 5 结论

​	开发出了用于分析具有自由表面的不可压缩流体的MPS方法。压力梯度，扩散，不可压缩性和自由表面使用包含核函数的确定性粒子相互作用来建模。由于MPS中修改的核函数和不可压缩性模型，数值稳定性和计算时间得到显着改善。通过测试计算来研究计算参数。对于粒子数密度和拉普拉斯模型的核尺寸，应使用不同的值。对于粒子数密度和拉普拉斯模型，所选择的核大小分别为2.1和4.0$l_0 $。自由表面模型中使用的参数 $\beta$ 在0.8到0.99的范围内对结果无影响；本研究选用0.97。利用这些选定的参数，计算水柱的坍塌并与实验进行比较。即使流体发生碎裂和聚结，良好的一致性也会持续到1.0秒。破碎前的前缘运动与SOLA-VOF的结果几乎相同。

​	如果使用网格求解过的其他物理过程以粒子相互作用建模并添加到MPS中，则MPS的应用将更广泛。例如，表示表面张力和相变的粒子相互作用模型对于许多的多相流问题是必需的。









